!function(e){function t(e){return e&&("onepage.php"===e||0===e.indexOf("onepager-")||0===e.indexOf("onepager/"))}function o(t,o){var n={action:"onepager_get_sections",pageId:t};o=o||"template-"+t;var i=o+".jpg";e.post(ajaxurl,n,function(e){e.success?a({name:o,screenshot:i,sections:e.sections}):alert("oops!! onepager could not export this page")})}function a(e){var t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,2)),o=document.getElementById("downloadAnchorElem");o.setAttribute("href",t),o.setAttribute("download",e.name+".json"),o.click()}function n(e,t){var o={action:"onepager_select_layout",layoutId:t,pageId:e};r(o)}function i(){var t={action:"onepager_get_sections",pageId:onepager.pageId},o={action:"onepager_save_sections",updated:null,pageId:onepager.pageId,sections:[]};e.post(ajaxurl,t,function(e){if(e&&e.success&&0!==e.sections.length){var t="Are you sure you want to insert this layout?This layout will replace your current layout!",a=confirm(t);if(!a)return;r(o)}else r(o)})}function r(t){e(".onepager-loading").css("display","block"),e.post(ajaxurl,t,function(t){t&&t.success?(location.href=onepager.buildModeUrl,e(".onepager-loading").css("display","none")):(e(".onepager-loading").css("display","none"),alert("failed to insert layout "))})}e(function(e){function a(){setTimeout(function(){if(e("#wpadminbar").length){y.length?(y.before(f),y.before(v)):($gutenberg=e("#editor"),$gutenberg.find(".edit-post-header-toolbar").append(v),$gutenberg.find(".edit-post-header-toolbar").append(f)),e(".block-editor")&&e(".block-editor").prepend(w);var t=e("#page_template"),o=e(".editor-page-attributes__template select");"onepage.php"==t.val()||"onepager-default.php"==t.val()||"onepage.php"==o.val()||"onepager-default.php"==o.val()?(f.hide(),v.show(),k.show(),e(".editor-block-list__layout, .wp-block.editor-writing-flow__click-redirect").hide(),e("#onepager_meta").removeClass("closed"),e("#onepager_meta .op-editpage-link").show()):(f.show(),v.hide())}else a()},1e3)}function r(){var t=e("#title");if(t.val()||(t.val("OnePager #"+e("#post_ID").val()),e("#title-prompt-text").addClass("screen-reader-text")),_.length)_.find('option[value="onepager/onepage.php"]').get(0)?_.val("onepager/onepage.php"):_.val("onepage.php"),_.trigger("change"),O.click();else{e(".onepager-loading").show();var o=wp.data.select("core/editor").getEditedPostAttribute("title");o||wp.data.dispatch("core/editor").editPost({title:"OnePager #"+e("#post_ID").val()}),wp.data.dispatch("core/editor").editPost({template:"onepage.php"}),e(".editor-block-list__layout, .wp-block.editor-writing-flow__click-redirect").hide(),wp.data.dispatch("core/editor").savePost(),l()}}function l(){setTimeout(function(){wp.data.select("core/editor").isSavingPost()?l():(w.hide(),f.hide(),v.show(),k.show(),s())},300)}function s(){_.length||setTimeout(function(){e("#post-title-0").focus()},500)}function p(){w.show(),_.length?(_.val("default"),_.trigger("change"),O.click()):(wp.data.dispatch("core/editor").editPost({template:""}),e(".editor-block-list__layout, .wp-block.editor-writing-flow__click-redirect").show(),wp.data.dispatch("core/editor").savePost(),c())}function c(){setTimeout(function(){wp.data.select("core/editor").isSavingPost()?c():(w.hide(),f.show(),v.hide(),k.hide())},300)}function d(){if(_.length){var t=e("#title");t.val()||(t.val("OnePager #"+e("#post_ID").val()),e("#title-prompt-text").addClass("screen-reader-text"))}else{var o=wp.data.select("core/editor").getEditedPostAttribute("title");o||wp.data.dispatch("core/editor").editPost({title:"OnePager #"+e("#post_ID").val()})}var a="Are you sure you want to insert this layout?This layout will replace your current layout!",i=e(this).attr("data-layout-id"),r=confirm(a);r&&(e(".onepager-loading").css("display","block"),n(h,i))}function g(e){o(h,"template"),e.preventDefault()}function u(){var o=e(this).val();setTimeout(function(){t(o)?(y.hide(),f.hide(),v.show(),k.show()):(y.show(),f.show(),v.hide(),k.hide())},10)}var h=onepager.pageId,f=e('<button type="button" id="enable-onepager" class="op-btn op-btn-with-logo">Enable Onepager</button>'),v=e('<button type="button" id="disable-onepager" class="op-btn op-btn-with-logo">Disable Onepager</button>'),w=e('<div class="onepager-loading" style="display:none"><div uk-spinner></div></div>'),b=e(".op-select-preset"),y=e("#postdivrich"),_=e("#page_template"),m=e("#onepager-export-layout"),k=e("#onepager_meta"),I=e("#blank-template"),P=e("#op-group-filter select"),x=e("#op-presets>.media"),O=e("#publish");window.exportSections=function(e,t){t=t||h,o(t,e)},P.on("change",function(){var t=e(this).val();x.hide(),e(t).show()}),m.on("click",g),_.on("change",u),_.trigger("change"),b.on("click",d),I.on("click",i),f.on("click",r),v.on("click",p),a()})}(jQuery);